<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>sse-driver-client-web</title>
</head>
<body>
<h1>司机监听测试页面-模拟司机客户</h1>
<button onclick="setMessageContent('鼠标点了一次')">测试message展示</button>
<div id="message">展示消息</div>
<button onclick="sourceClose()">关闭连接</button>
<script>
    driverId=1
    source = null;
    if (window.EventSource){
        console.info("此浏览器支持sse");
        source = new EventSource("http://localhost:9000/connect/"+driverId);
        source.addEventListener("message", function (e){
            content = e.data;
            console.info("消息内容:" + content);
            setMessageContent(content);
        })
    }else {
        console.log("浏览器不支持sse")
    }

    function setMessageContent(content){
        document.getElementById("message").innerHTML+=(content+'</br>');
    }

    function sourceClose(){
        console.info("close方法执行")
        //客户端source的关闭
        source.close();
        //服务端map的移除
        httpRequest = new XMLHttpRequest();
        httpRequest.open("get", "http://localhost:9000/close/" + driverId);
        httpRequest.send()
    }
</script>
</body>
</html>